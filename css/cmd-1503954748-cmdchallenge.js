var GLOBAL_VERSION=1,CMD_URL="https://api2.cmdchallenge.com",TAB_COMPLETION=["war_and_peace.txt","sum-me.txt","find","echo","awk","sed","perl","wc","grep","access.log","cat","sort","README","split-me.txt","file-with-tabs.txt","cut","faces.txt","random-numbers.txt","table.csv"],STORAGE_CORRECT="correct_answers",BADGE_MSGS={b0:"Are you up for the command line challenge? Solve the tasks printed below in a single line of bash.",b1:"You are off to a great start, keep on going!",b2:"You have a shrug-man, this means you are doing well!",b3:"On your way to becoming a super-duper commandline hacker.",b4:"Wow, not many have gotten this far... don't stop!",b5:"I'm impressed at how far you have gotten... keep at it!",b6:"You are officially a command line master, great job!"},BADGE_CUTOFFS={100:"b6",80:"b5",50:"b4",25:"b3",10:"b2"};jQuery(function(e){var t,n,o,r,c,a,l,i,u,s,d,h,g,m,f,p,E,y,v,b,w,O,B={},C=!1;O=function(){B&&!C&&(n=i("0","green"),B.description.split(/\n/).forEach(function(e){t.echo(i("# "+e,"teal"))}))},h=function(e){var t;try{t=JSON.parse(localStorage.getItem(e))}catch(e){t=[]}return null===t&&(t=[]),_.uniq(t)},g=function(e,t,n){var o,r;o=h(t),r=JSON.stringify(o.concat([e])),localStorage.setItem(t,r),"function"==typeof n&&n()},f=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},v=function(){var t=h(STORAGE_CORRECT);r.filter(function(e){return-1!==t.indexOf(e.slug)}).length===r.length?(document.getElementById("header").style.display="none",document.getElementById("breakout-box").style.display="block",e.getScript("js/cmd-1503954748-figlet-breakout.min.js",function(){window.Breakout()})):(document.getElementById("header").style.display="block",document.getElementById("breakout-box").style.display="none")},m=function(e){var t=h(STORAGE_CORRECT);e.forEach(function(e){if(-1!==t.indexOf(e.slug)){var n=document.getElementById(e.slug);s(n,"checked")}})},i=function(e,t,n){return n||(n=""),"[["+n+";"+t+";black]"+e+"]"},u=function(e,t){t.forEach(function(t){var n=document.getElementById(t.slug),o=n.parentNode;n.id===e?s(o,"active_challenge"):d(o,"active_challenge")})},s=function(e,t){e.classList?e.classList.add(t):e.class_name+=" "+t},d=function(e,t){e.classList?e.classList.remove(t):e.class_name=e.class_name.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},l=function(e,t,n){var o=document.getElementById("challenges"),r=document.getElementById("user-challenges"),c={};e.forEach(function(n){var a=document.createElement("a");a.id=n.slug,a.href="#/"+n.slug,a.title=n.slug;var l=document.createTextNode(n.slug+"/");a.appendChild(l);var s=document.createElement("li");s.appendChild(a),f("click",a,function(e){e.preventDefault(),e.stopPropagation(),routie("/"+n.slug)}),n.author&&"cmdchallenge"!==n.author?r.appendChild(s):o.appendChild(s),c["/"+n.slug]=function(){u(n.slug,e),B=n,document.getElementById("solution").setAttribute("href","/s/#/"+n.slug),t.echo(i("# ","teal")+i("You have a new challenge!","white")),B.description.split(/\n/).forEach(function(e){t.echo(i("# "+e,"teal"))}),b("")}});var a=document.createElement("li"),l=document.createElement("a");l.href="https://github.com/jarv/cmdchallenge#contribute",l.title="[ add a challenge ]";var s=document.createTextNode("[ add a challenge ]");l.appendChild(s),a.appendChild(l),a.id="add_challenge",r.appendChild(a),routie(c),"function"==typeof n&&n()},y=function(){b(""),document.getElementById("badge_text").innerHTML=E()},E=function(){var e,t,n,o,c=h(STORAGE_CORRECT).length,a=Object.keys(BADGE_CUTOFFS).map(function(e){return Number(e)}).sort(function(e,t){return e-t}),l=Math.floor(c/r.length*100);if(0===c)return BADGE_MSGS.b0;for(c>=1&&(t=BADGE_MSGS.b1,n=document.getElementById("b1"),s(n,"completed")),e=0;e<a.length;e++)o=BADGE_CUTOFFS[a[e].toString()],n=document.getElementById(o),l>=a[e]?(t=BADGE_MSGS[o],s(n,"completed")):d(n,"completed");return t},c=function(t){e.ajax({dataType:"json",url:"/challenges/cmd-1503954748-challenges.json",success:function(e){"function"==typeof t&&t(e)},error:function(){n="‚ò†Ô∏è",alert("error")}})},a=function(t,n){var o;o={cmd:t,challenge_slug:B.slug,version:B.version,g_version:GLOBAL_VERSION},e.ajax({type:"GET",url:CMD_URL,async:!0,data:o,success:function(e){"function"==typeof n&&n(e)},error:function(e){if("function"==typeof n){var t=e.responseText||"Unknown Error :(";n({output:t,correct:!1,return_code:"‚ò†Ô∏è"})}}})},b=function(e){document.getElementById("error_text").innerHTML=e},p=function(e,t){var n,o=t.map(function(e){return e.slug}).indexOf(e),r=h(STORAGE_CORRECT);for(n=o+1;n<t.length;n++)if(-1===r.indexOf(t[n].slug))return t[n];return t[0]},w=function(n){var o,r,c,a,l,i,u=n,s=0,d=0;C=!0,l=function(){t.clear(),t.echo(a.slice(s,s+r-1).join("\n"))},t.resume(),o=t.export_view(),r=t.rows(),c=[],a=u.split("\n"),console.log(a),c.push(function(){C&&(r=t.rows(),l())}),l(),t.push(e.noop,{keydown:function(e){if("/"!==t.get_prompt())return 191===e.which?t.set_prompt("/"):38===e.which||75===e.which?s>0&&(--s,l()):40===e.which||74===e.which?s<a.length-1&&(++s,l()):34===e.which||32===e.which?((s+=r)>a.length-1-r&&(s=a.length-1-r),l()):33===e.which?((s-=r)<0&&(s=0),l()):81===e.which&&(C=!1,t.pop().import_view(o)),!1;if(8===e.which&&""===t.get_command())t.set_prompt(":");else if(13===e.which){var n=t.get_command();if(n.length>0){for(i=new RegExp(n),d=0;d<a.length;++d)if(i.test(a[d])){s=d,l(),t.set_command("");break}t.set_command(""),t.set_prompt(":")}return!1}},prompt:":"})},o=document.getElementById("reset"),n=i("0","green"),f("click",o,function(e){e.preventDefault(),localStorage.clear(),location.reload()}),c(function(o){var c=null;B=null,r=o.filter(function(e){return!e.author||"cmdchallenge"===e.author}),y(),e("#term_challenge").terminal(function(e,t){""!==(e=e.replace(/^\s+|\s+$/g,""))?(t.pause(),a(e,function(r){n=0===r.return_code?i(r.return_code,"green"):i(r.return_code,"red"),e.match(/^man +[^ ]+/)?w(r.output):t.echo(r.output),r.correct?(t.echo(i("# üëç üëç üëç  Correct!","green")),g(r.challenge_slug,STORAGE_CORRECT,function(){var e=document.getElementById(r.challenge_slug);document.getElementById("error_text").innerHTML="",s(e,"checked"),c=p(r.challenge_slug,o),y(),v(),c&&(B=c,routie("/"+B.slug))})):r.test_errors&&r.test_errors.length>0?b(r.test_errors[0]+" - try again"):r.rand_error&&b("Test against random data failed - try again"),t.resume()})):t.echo("")},{greetings:"",name:"js_demo",height:300,convertLinks:!0,prompt:function(e){e("bash("+n+")> ")},completion:TAB_COMPLETION,onClear:O}),t=e.terminal.active(),l(o,t,function(){B||(B=o[0]).description.split(/\n/).forEach(function(e){t.echo(i("# "+e,"teal"))}),m(o),v()})})});
